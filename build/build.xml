<project default="minify">
	
	<property name="src" location="../src" />
	<property name="deploy" location="../deploy" />
	
	<path id="yuicompressor.classpath">
		<fileset dir="./">
			<include name="yuicompressor-2.4.7.jar"/>
			<include name="YUIAnt.jar"/>
		</fileset>
	</path>
	
	<target name="reset" description="Empty the deploy folder">
		<delete>
			<fileset dir="${deploy}">
				<include name="*.js" />
			</fileset>
		</delete>
	</target>
	
	<target name="copy" depends="reset" description="Moving source file to deploy folder">
		<copy todir="${deploy}">
			<fileset dir="${src}" includes="*.js" />
		</copy>
	</target>
	
	<target name="concate" depends="copy" description="Concate all source files into a single file">
		<concat destfile="${deploy}/temp.js" force="yes" overwrite="yes">
			<filelist dir="${deploy}" files="core.js,fn.js,defaults.js,fx.js,intl.js,layouts.js"/>
		</concat>
	</target>
	
	<target name="compile" depends="concate" description="Minifiy">
		<loadfile property="laboiteSrc" srcFile="${deploy}/temp.js"/>
		<replace file="${deploy}/template.js" token="--laboite--" value="${laboiteSrc}"/>
		<delete>
			<fileset dir="${deploy}">
				<include name="*.js" />
				<exclude name="template.js" />
			</fileset>
		</delete>
		<move file="${deploy}/template.js" tofile="${deploy}/laboite2.js" overwrite="yes"/>
	</target>
	
	<target name="minify" depends="compile" description="Minifiy">
		<taskdef name="yuicompress" classname="com.yahoo.platform.yui.compressor.YUICompressTask">
			<classpath>
				<path refid="yuicompressor.classpath"/>
			</classpath>
		</taskdef>
		<yuicompress linebreak="300" warn="false" munge="yes" preserveallsemicolons="true" outputfolder="${deploy}">
			<fileset dir="${deploy}">
				<include name="*.js" />
			</fileset>
		</yuicompress>
	</target>

</project>
			
	