/*! laboite 2 - Copyright 2011, Gilles Cochez - Released under the MIT, BSD, and GPL Licenses. */
(function(c){var e=c(window),d=c(document),a="not found",b="body:eq(0)";c.laboite=function(f){var g=this;c.extend(g,{name:"laboite",version:"2.0",init:function(h,j,i){g.options=c.extend({},c.laboite.defaults,h);
g.layouts=c.extend({},c.laboite.layouts,j);g.languages=c.extend({},c.laboite.languages,i);g.uicache=[];g.loaded=[];g.indom=false;g.layout=null;g.animate=false;g.currentIndex=g.options.defaultIndex;if(!g.options.data){g.call("getData");}else{g.call("run");}},run:function(){if(g.options.data){g.call("resetCount");
g.call("buildUI");if(g.inject&&g.injectType=="replace"){g.call("goToId",g.currentIndex);}else{f.live(g.options.onEvent,function(h){h.preventDefault();if(g.options.inject){g.call("goToId",c(this).index());}else{g.call("open",this);}});}}},buildUI:function(){g.layout=g.call("getLayout",g.options.layout);
c('[class^="'+g.options.css.prefix+'"]',g.layout).each(function(l){var n=this.className,o=n.split(" "),j=n.length-1;if(j){for(var m=0;m<j;m++){if(o[m]&&o[m].indexOf(g.options.css.prefix)!==-1){var p=o[m].replace(g.options.css.prefix,"");g.uicache[p]=c(this);if(c.isFunction(g[p])){g.uicache[p].click(function(i){i.preventDefault();
g.call(p);});}}}}});if(!g.options.slideshow){c.each(["play","pause","stop"],function(j,i){g.uicache[i].hide();});g.layout.addClass(g.options.css.prefix+g.options.css.slideshowDisabled);}if(g.options.inject){var h=c(g.options.injectTarget);if("append"==g.options.injectType||"prepend"==g.options.injectType){h[g.options.injectType](g.layout);
}else{if("replace"==g.options.injectType){h.html(g.layout);}else{g.error("invalid injectType");return false;}}g.indom=true;g.call("goToId",g.options.defaultIndex);}else{g.layout.css("opacity",0);if(g.options.dimmer){g.uicache["dimmer"]=c('<div class="'+g.options.css.prefix+g.options.css.dimmer+'" />').hide().bind("click",function(){g.call("close");
}).appendTo(b);}}},goToId:function(h){if(h>=0&&h<=g.options.__count-1){g.call("load",h);}else{if(g.options.continuous){if(h<0){var i=g.options.__count-1;}else{var i=0;}g.call("load",i);}}},open:function(h){g.call("openDimmer");if(!g.indom){g.layout.appendTo(b).fadeTo(g.options.dimmerFadeDuration,1);g.call("positionUI");
g.indom=true;}else{g.layout.fadeTo(g.options.dimmerFadeDuration,1);}g.call("modalBind");g.call("goToId",c(h).index());},close:function(){g.call("closeDimmer");g.layout.fadeTo(g.options.dimmerFadeDuration,0,function(){g.layout.hide();});g.call("modalUnbind");},play:function(){g.t=setInterval(function(){g.call("next");
},g.options.slideshowDelay);},pause:function(){clearInterval(g.t);},stop:function(){g.call("pause");g.call("goToId",0);},next:function(){g.call("goToId",g.currentIndex+1);},previous:function(){g.call("goToId",g.currentIndex-1);},switchItem:function(h){g.call("hideItem",function(){g.uicache["content"].html(g.loaded[g.currentIndex]);
g.call("showItem");});},hideItem:function(j){var k=c.laboite.fx[g.options.effect].hide;var i=k.css;var h={};if(j){h.complete=function(){j();};}c.extend({},k.config,h);g.uicache["content"].animate(i,h);},showItem:function(j){var k=c.laboite.fx[g.options.effect].show;var i=k.css;var h={};if(j){h.complete=function(){j();
};}c.extend({},k.config,h);g.uicache["content"].animate(i,h);},hideLoader:function(){},showLoader:function(){},load:function(h){g.currentIndex=h;if(g.loaded[h]){g.call("switchItem",h);}else{g.call("showLoader");g.call("hideItem",function(){var i=g.call("getType",h);if(g["load"+i]){g.call("load"+i,h);
}else{g.call("loadIframe",h);}});}},getType:function(h){var i="Image";if(!g.options.loadAsImage){if(g.options.data.items[h].type){i=data.items[h].type;}else{var k=g.options.data.items[h].source;var j=k.split(".");var l=j[j.length-1];}}return i;},loadImage:function(i){var h=new Image(),k=g.options.data.items[i]["source"]||false,j=g.options.data.items[i]["title"]||"";
if(!k){g.error('source not found for index "'+i+'"');return false;}c(h).bind("load",function(){c(this).remove();var l=c('<img src="'+k+'" alt="'+j+'" />');g.loaded[i]=l;g.uicache["content"].empty().append(g.loaded[i]);g.call("showItem");if(!g.options.inject){g.call("positionUI");}}).attr("src",k);},loadSwf:function(h){},loadIframe:function(h){},positionUI:function(){if(g.options.modalTarget){var h=c(g.options.modalTarget),i=h.offset();
if(i!=null){g.layout.css({top:i.top+g.options.modalOffsetTop,left:i.left+g.options.modalOffsetLeft});}}else{g.call("centerUI");}},centerUI:function(){var j={w:g.layout.width(),h:g.layout.height()};var k={w:e.width(),h:e.height()};var h=parseInt((k.h-j.h)/2);var i=parseInt((k.w-j.w)/2);if(h<0){h=0;}if(i<0){i=0;
}g.layout.css({top:h,left:i});},getLayout:function(){if(!g.layouts[g.options.layout]){g.error(g.options.layout+" layout "+a);return false;}if(!g.languages[g.options.lang]){g.error(g.options.lang+" language "+a);return false;}var h=g.layouts[g.options.layout]();c.each(g.languages[g.options.lang],function(j,i){h=h.replace(new RegExp("\\${"+j+"}","g"),i);
});return c(h);},openDimmer:function(){if(g.options.dimmer&&g.uicache["dimmer"]){if(g.options.dimmerMatchBackground){var h=c(b),i=["background-color","background-image","background-repeat","background-position"];c.each(i,function(l,j){var m=h.css(j);if(m!=""){g.uicache["dimmer"].css(j,m);}});}g.uicache["dimmer"].css({position:"absolute",height:d.height(),width:d.width(),left:0,top:0}).fadeTo(g.options.dimmerFadeDuration,g.options.dimmerOpacity);
}},modalBind:function(){e.bind("resize",function(){g.uicache["dimmer"].css({height:d.height(),width:d.width()});});if(g.options.modalKeepAtCenter){d.bind("scroll",function(){g.call("centerUI");});}},modalUnbind:function(){e.unbind("resize."+g.name+" scroll."+g.name);d.unbind("scroll."+g.name);},closeDimmer:function(){g.uicache["dimmer"].fadeTo(g.options.dimmerFadeDuration,0,function(){g.uicache["dimmer"].hide();
e.unbind("resize."+g.name);});},resetCount:function(){g.options.__count=g.options.data.items.length;},getData:function(){if(g.options.dataUrl){c.ajax({url:g.options.dataUrl,dataType:g.options.jsonp?"jsonp":"json",error:function(){g.error(g.options.dataUrl+" "+a);},success:function(h){if(h.items){g.options.data=h;
g.call("run");}}});}else{g.call("getDataFromDom");}},getDataFromDom:function(){var h=[];g.options.data={};f.each(function(j){var k=c(this);h[j]={};c.each(g.options.attributes,function(m,l){var i=k.attr(l);if(i){h[j][m]=i;}});});g.options.data.items=h;g.call("run");},call:function(i){if(g.options.callbacks[i+"Before"]){g.options.callbacks[i+"Before"]();
}g.log(i+"("+Array.prototype.slice.call(arguments,1)+")");var h=g[i].apply(null,Array.prototype.slice.call(arguments,1));if(g.options.callbacks[i+"After"]){g.options.callbacks[i+"After"]();}return(!h)?true:h;},get:function(h){if(!h){return g.options;}if(g.options[h]){return g.options[h];}else{g.error("get("+h+") "+a);
}},set:function(i,h){if(!i&&!h){g.error("set() missing arguments");return false;}else{g.options[i]=h;}},error:function(h){if(g.options.debug){h=g.name+": "+h;if(console.error){console.error(h);}else{alert(h);}}},log:function(h){if(g.options.log&&console.log){h=g.name+": "+h;console.log(h);}},test:function(h){return g.options[h];
}});};c.fn.laboite=function(){if(!c(this).data("laboite")){c(this).data("laboite",new c.laboite(this));c(this).data("laboite")["init"].apply(null,arguments);}else{if(arguments.length){if(typeof arguments[0]=="string"){if(c(this).data("laboite")[arguments[0]]){var f=c(this).data("laboite")[arguments[0]].apply(null,Array.prototype.slice.call(arguments,1));
}}}}return f||this;};c.laboite.defaults={lang:"en",log:false,debug:false,data:false,dataURL:false,jsonp:false,layout:"modal",inject:false,injectType:"append",injectTarget:"",modalAtCenter:true,modalKeepAtCenter:true,modalTarget:null,modalOffsetTop:0,modalOffsetLeft:0,slideshow:false,slideshowDelay:5000,dimmer:true,dimmerOpacity:0.5,dimmerBindToClose:true,dimmerFadeDuration:200,dimmerMatchBackground:false,effect:"fade",defaultIndex:0,continuous:false,callbacks:{},autorun:true,onEvent:"click",loadAsImage:false,transitionDuration:1000,css:{prefix:"laboite-",play:"play",pause:"pause",stop:"stop",previous:"previous",next:"next",autorun:"autorun",items:"items",item:"item",itemWrap:"item-wrap",slideshowDisabled:"slideshowDisabled",slideshowOn:"slideshowOn",slideshowOff:"slideshowOff",itemLoading:"itemLoading",itemLoaded:"itemLoaded",dimmer:"dimmer"},attributes:{title:"title",source:"href",maxWidth:"data-laboite-maxWidth",maxHeight:"data-laboite-maxHeight",minWidth:"data-laboite-minWidth",minHeight:"data-laboite-minHeight",link:"data-laboite-link",linkTarget:"data-laboite-linkTarget",description:"data-laboite-description"}};
c.laboite.fx={fade:{init:{css:{opacity:1}},hide:{css:{opacity:0},config:{duration:500}},show:{css:{opacity:1},config:{duration:500}}},foo:{init:{},hide:{css:{},config:{duration:1000}},show:{css:{},config:{duration:1000}}}};c.laboite.languages={"en":{close:"Close",previous:"Previous",next:"Next",play:"Play",pause:"Pause",stop:"Stop",stats:"${current} out of ${total}"},"fr":{close:"Fermer",previous:"Precedent",next:"Suivant",play:"Commencer",pause:"Pauser",stop:"Arreter",stats:"${current} de ${total}"}};
c.laboite.layouts={modal:function(){var f='<div class="laboite-wrap laboite-modal">';f+='<a href="#close" class="laboite-close"><span>${close}</span></a>';f+='<div class="laboite-content"></div>';f+='<div class="laboite-controls">';f+='<a href="#previous" class="laboite-button laboite-previous"><span>${previous}</span></a>';
f+='<a href="#next" class="laboite-button laboite-next"><span>${next}</span></a>';f+='<a href="#play" class="laboite-button laboite-play"><span>${play}</span></a>';f+='<a href="#pause" class="laboite-button laboite-pause"><span>${pause}</span></a>';f+='<a href="#stop" class="laboite-button laboite-stop"><span>${stop}</span></a>';
f+='<span class="laboite-stats"></span>';f+="</div>";f+="</div>";return f;},inline:function(){var f='<div class="laboite-wrap laboite-inline">';f+='<div class="laboite-controls">';f+='<a href="#previous" class="laboite-button laboite-previous"><span>${previous}</span></a>';f+='<a href="#next" class="laboite-button laboite-next"><span>${next}</span></a>';
f+='<a href="#play" class="laboite-button laboite-play"><span>${play}</span></a>';f+='<a href="#pause" class="laboite-button laboite-pause"><span>${pause}</span></a>';f+='<a href="#stop" class="laboite-button laboite-stop"><span>${stop}</span></a>';f+='<span class="laboite-stats"></span>';f+="</div>";
f+='<div class="laboite-content"></div>';f+="</div>";return f;},popup:function(){var f="<!DOCTYPE html><html><title></title><body>";f+='<div class="laboite-wqrap  laboite-popup">';f+='<a  href="#close" class="laboite-button laboite-close"><span>Close</span></a>';f+='<div class="laboite-content"></div>';
f+='<div class="laboite-controls">';f+='<a href="#previous" class="laboite-button laboite-previous"><span>${previous}</span></a>';f+='<a href="#next" class="laboite-button laboite-next"><span>${next}</span></a>';f+='<a href="#play" class="laboite-button laboite-play"><span>${play}</span></a>';f+='<a href="#pause" class="laboite-button laboite-pause"><span>${pause}</span></a>';
f+='<a href="#stop" class="laboite-button laboite-stop"><span>${stop}</span></a>';f+='<span class="laboite-stats"></span>';f+="</div>";f+="</div></body></html>";return f;}};})(jQuery);